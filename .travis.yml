dist: xenial
language: python
python:
    - 2.7
    - 3.5
services:
    - mysql
    - postgresql
env:
    - DJANGO=1.11 DATABASE_ENGINE=sqlite
    - DJANGO=1.11 DATABASE_ENGINE=postgres
    - DJANGO=1.11 DATABASE_ENGINE=mysql
    - DJANGO=2.0 DATABASE_ENGINE=sqlite
    - DJANGO=2.0 DATABASE_ENGINE=postgres
    - DJANGO=2.0 DATABASE_ENGINE=mysql
    - DJANGO=2.1 DATABASE_ENGINE=sqlite
    - DJANGO=2.1 DATABASE_ENGINE=postgres
    - DJANGO=2.1 DATABASE_ENGINE=mysql
    - DJANGO=2.2a1 DATABASE_ENGINE=sqlite
    - DJANGO=2.2a1 DATABASE_ENGINE=postgres
    - DJANGO=2.2a1 DATABASE_ENGINE=mysql
matrix:
    exclude:
        - python: 2.7
          env: DJANGO=2.0 DATABASE_ENGINE=sqlite
        - python: 2.7
          env: DJANGO=2.0 DATABASE_ENGINE=postgres
        - python: 2.7
          env: DJANGO=2.0 DATABASE_ENGINE=mysql
        - python: 2.7
          env: DJANGO=2.1 DATABASE_ENGINE=sqlite
        - python: 2.7
          env: DJANGO=2.1 DATABASE_ENGINE=postgres
        - python: 2.7
          env: DJANGO=2.1 DATABASE_ENGINE=mysql
        - python: 2.7
          env: DJANGO=2.2 DATABASE_ENGINE=sqlite
        - python: 2.7
          env: DJANGO=2.2 DATABASE_ENGINE=postgres
        - python: 2.7
          env: DJANGO=2.2 DATABASE_ENGINE=mysql
install:
    - pip install -U setuptools
    - python bootstrap.py
    - ./bin/buildout versions:django=$DJANGO
    - sh -c "if [ '$DATABASE_ENGINE' = 'postgres' ];
      then
        pip install psycopg2;
        psql -c 'create database tagging;' -U postgres;
      fi"
    - sh -c "if [ '$DATABASE_ENGINE' = 'mysql' ];
      then
        pip install mysqlclient < 1.3.14;  # Django 1.11 doesn't support later versions.
        mysql -e 'create database tagging CHARACTER SET utf8 COLLATE utf8_general_ci;';
        mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root mysql;
      fi"
before_script:
    - ./bin/flake8 tagging
script:
    - ./bin/test-and-cover
after_success:
    - ./bin/coveralls
notifications:
    irc:
        - "irc.freenode.org#django-tagging"
